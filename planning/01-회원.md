# 회원 (Member) 도메인

## 개요
사용자 계정 생성, 인증, 관리

---

## 엔티티

### Member
| 필드 | 타입 | 설명 |
|------|------|------|
| id | string | 사용자 고유 ID |
| loginId | string | 로그인 아이디 (URL 겸용: scanly.io/u/{loginId}) |
| password | string | 비밀번호 (해시) |
| email | string | 이메일 (연락처/알림용, nullable) |
| status | enum | ACTIVE, INACTIVE, WITHDRAWN |
| withdrawnAt | datetime | 탈퇴 요청일시 (nullable) |
| createdAt | datetime | 가입일시 |
| updatedAt | datetime | 수정일시 |

---

## 규칙 및 정책

### 회원가입 규칙
| 규칙 | 내용 |
|------|------|
| 로그인 아이디 | 영문, 숫자, 언더스코어만 허용 (3-20자), 중복 불가 |
| 비밀번호 | 최소 8자, 영문 + 숫자 조합 필수 |
| 이메일 | 유효한 이메일 형식 (선택사항, 알림 수신용) |

### 로그인 규칙
| 규칙 | 내용 |
|------|------|
| 로그인 실패 | 5회 연속 실패 시 10분간 로그인 제한 |
| 토큰 만료 | Access Token 1시간, Refresh Token 14일 |
| 동시 로그인 | 허용 (기기 수 제한 없음) |

### 계정 관리 규칙
| 규칙 | 내용 |
|------|------|
| 로그인 아이디 변경 | 변경 불가 (고정, URL에 사용되므로) |
| 비밀번호 변경 | 현재 비밀번호 확인 필요 |
| 이메일 변경 | 자유롭게 변경 가능 |
| 계정 탈퇴 | 요청 후 30일 유예, 이후 완전 삭제 |
| 탈퇴 취소 | 30일 이내 로그인 시 탈퇴 취소 가능 |

### 소셜 로그인 규칙
| 규칙 | 내용 |
|------|------|
| 지원 플랫폼 | Google, Apple, Kakao |
| 로그인 아이디 | 소셜 가입 시에도 로그인 아이디 입력 필수 (URL용) |
| 비밀번호 | 소셜 가입자는 비밀번호 설정 선택사항 |

---

## 기능

### 1. 회원가입
- 로그인 아이디 + 비밀번호
- 소셜 로그인 (Google, Apple, Kakao)
- 로그인 아이디가 URL에 사용됨 (scanly.io/u/{loginId})
- 이메일 입력 (선택, 알림 수신용)

### 2. 로그인
- 로그인 아이디/비밀번호 로그인
- 소셜 로그인
- 자동 로그인 (Refresh Token)

### 3. 계정 관리
- 비밀번호 변경
- 이메일 변경
- 계정 삭제 (탈퇴)
- 탈퇴 취소

---

## 시나리오

### 시나리오 1: 일반 회원가입
```
1. 회원가입 화면 진입
2. 로그인 아이디, 비밀번호 입력
3. 이메일 입력 (선택)
4. [가입하기] 클릭
5. 로그인 아이디 중복 체크 → 통과
6. 계정 생성 (status: ACTIVE)
7. 명함 생성 화면으로 이동
```

### 시나리오 2: 소셜 로그인 (신규)
```
1. 로그인 화면에서 [Google] 클릭
2. Google 인증 완료
3. 신규 회원으로 판단
4. 로그인 아이디 입력 화면 표시
5. 로그인 아이디 입력 후 가입 완료
6. 명함 생성 화면으로 이동
```

### 시나리오 3: 소셜 로그인 (기존 회원)
```
1. 로그인 화면에서 [Kakao] 클릭
2. Kakao 인증 완료
3. 기존 회원 조회 → 있음
4. 홈 화면으로 이동
```

### 시나리오 4: 계정 탈퇴
```
1. 설정 → 계정 관리 → 계정 삭제
2. 비밀번호 확인 (또는 소셜 재인증)
3. 탈퇴 사유 선택 (선택사항)
4. [탈퇴하기] 클릭
5. status: WITHDRAWN, withdrawnAt 기록
6. 로그아웃 처리
7. 30일 후 배치로 완전 삭제
```

### 시나리오 5: 탈퇴 취소
```
1. 탈퇴 요청 후 30일 이내 로그인 시도
2. "탈퇴 요청 중인 계정입니다. 취소하시겠습니까?" 팝업
3. [예] 클릭
4. status: ACTIVE, withdrawnAt: null
5. 홈 화면으로 이동
```

---

## 화면

### 로그인
```
┌─────────────────────────────┐
│                             │
│         Scanly              │
│                             │
│  아이디 ────────────        │
│  비밀번호 ──────────        │
│                             │
│       [로그인]              │
│                             │
│  ─────── 또는 ───────       │
│                             │
│  [Google] [Apple] [Kakao]   │
│                             │
│  계정이 없으신가요? 회원가입  │
└─────────────────────────────┘
```

### 회원가입
```
┌─────────────────────────────┐
│  ← 회원가입                  │
│                             │
│  아이디 (URL에 사용됩니다)   │
│  scanly.io/u/────────       │
│  ✓ 사용 가능한 아이디입니다  │
│                             │
│  비밀번호 ──────────        │
│  비밀번호 확인 ─────        │
│                             │
│  이메일 (선택)              │
│  ────────────────           │
│                             │
│       [가입하기]            │
└─────────────────────────────┘
```

---

## API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/auth/signup | 회원가입 |
| POST | /api/auth/login | 로그인 |
| POST | /api/auth/logout | 로그아웃 |
| POST | /api/auth/refresh | 토큰 갱신 |
| POST | /api/auth/social/:provider | 소셜 로그인 |
| GET | /api/members/me | 내 정보 조회 |
| PUT | /api/members/me | 내 정보 수정 |
| PUT | /api/members/me/password | 비밀번호 변경 |
| DELETE | /api/members/me | 계정 탈퇴 |
| POST | /api/members/me/cancel-withdrawal | 탈퇴 취소 |
| GET | /api/members/check-login-id/:loginId | 로그인 아이디 중복 체크 |

---

## 개발 우선순위
1. Phase 1: 로그인 아이디 회원가입/로그인
2. Phase 2: 소셜 로그인, 계정 탈퇴/취소
