# 회원 (Member) 도메인

## 개요
사용자 계정 생성, 인증, 관리

---

## 엔티티

### Member
| 필드 | 타입 | 설명 |
|------|------|------|
| id | string | 사용자 고유 ID |
| email | string | 이메일 (로그인 ID) |
| password | string | 비밀번호 (해시) |
| username | string | 고유 사용자명 (URL용) |
| status | enum | ACTIVE, INACTIVE, WITHDRAWN |
| withdrawnAt | datetime | 탈퇴 요청일시 (nullable) |
| createdAt | datetime | 가입일시 |
| updatedAt | datetime | 수정일시 |

---

## 규칙 및 정책

### 회원가입 규칙
| 규칙 | 내용 |
|------|------|
| 이메일 | 유효한 이메일 형식, 중복 불가 |
| 비밀번호 | 최소 8자, 영문 + 숫자 조합 필수 |
| username | 영문, 숫자, 언더스코어만 허용 (3-20자), 중복 불가 |
| 이메일 인증 | 가입 후 24시간 내 인증 필요 (미인증 시 기능 제한) |

### 로그인 규칙
| 규칙 | 내용 |
|------|------|
| 로그인 실패 | 5회 연속 실패 시 10분간 로그인 제한 |
| 토큰 만료 | Access Token 1시간, Refresh Token 14일 |
| 동시 로그인 | 허용 (기기 수 제한 없음) |

### 계정 관리 규칙
| 규칙 | 내용 |
|------|------|
| 이메일 변경 | 새 이메일 인증 필요 |
| 비밀번호 변경 | 현재 비밀번호 확인 필요 |
| username 변경 | 변경 불가 (고정) |
| 계정 탈퇴 | 요청 후 30일 유예, 이후 완전 삭제 |
| 탈퇴 취소 | 30일 이내 로그인 시 탈퇴 취소 가능 |

### 소셜 로그인 규칙
| 규칙 | 내용 |
|------|------|
| 지원 플랫폼 | Google, Apple, Kakao |
| 계정 연동 | 동일 이메일 존재 시 기존 계정과 연동 |
| 비밀번호 | 소셜 가입자는 비밀번호 설정 선택사항 |

---

## 기능

### 1. 회원가입
- 이메일 + 비밀번호
- 소셜 로그인 (Google, Apple, Kakao)
- username 설정 (scanly.io/u/{username})
- 이메일 인증 발송

### 2. 로그인
- 이메일/비밀번호 로그인
- 소셜 로그인
- 자동 로그인 (Refresh Token)

### 3. 계정 관리
- 비밀번호 변경
- 이메일 변경
- 계정 삭제 (탈퇴)
- 탈퇴 취소

---

## 시나리오

### 시나리오 1: 이메일 회원가입
```
1. 회원가입 화면 진입
2. 이메일, 비밀번호, username 입력
3. [가입하기] 클릭
4. 이메일 중복 체크 → 통과
5. username 중복 체크 → 통과
6. 계정 생성 (status: INACTIVE)
7. 인증 이메일 발송
8. 사용자가 이메일 링크 클릭
9. 이메일 인증 완료 (status: ACTIVE)
10. 명함 생성 화면으로 이동
```

### 시나리오 2: 소셜 로그인 (신규)
```
1. 로그인 화면에서 [Google] 클릭
2. Google 인증 완료
3. 이메일로 기존 회원 조회 → 없음
4. username 입력 화면 표시
5. username 입력 후 가입 완료
6. 명함 생성 화면으로 이동
```

### 시나리오 3: 소셜 로그인 (기존 회원)
```
1. 로그인 화면에서 [Kakao] 클릭
2. Kakao 인증 완료
3. 이메일로 기존 회원 조회 → 있음
4. 기존 계정과 소셜 연동
5. 홈 화면으로 이동
```

### 시나리오 4: 계정 탈퇴
```
1. 설정 → 계정 관리 → 계정 삭제
2. 비밀번호 확인 (또는 소셜 재인증)
3. 탈퇴 사유 선택 (선택사항)
4. [탈퇴하기] 클릭
5. status: WITHDRAWN, withdrawnAt 기록
6. 로그아웃 처리
7. 30일 후 배치로 완전 삭제
```

### 시나리오 5: 탈퇴 취소
```
1. 탈퇴 요청 후 30일 이내 로그인 시도
2. "탈퇴 요청 중인 계정입니다. 취소하시겠습니까?" 팝업
3. [예] 클릭
4. status: ACTIVE, withdrawnAt: null
5. 홈 화면으로 이동
```

---

## 화면

### 로그인
```
┌─────────────────────────────┐
│                             │
│         Scanly              │
│                             │
│  이메일 ────────────        │
│  비밀번호 ──────────        │
│                             │
│       [로그인]              │
│                             │
│  ─────── 또는 ───────       │
│                             │
│  [Google] [Apple] [Kakao]   │
│                             │
│  계정이 없으신가요? 회원가입  │
└─────────────────────────────┘
```

### 회원가입
```
┌─────────────────────────────┐
│  ← 회원가입                  │
│                             │
│  이메일 ────────────        │
│  비밀번호 ──────────        │
│  비밀번호 확인 ─────        │
│                             │
│  사용자명 (URL에 사용됩니다) │
│  scanly.io/u/────────       │
│  ✓ 사용 가능한 사용자명입니다 │
│                             │
│       [가입하기]            │
└─────────────────────────────┘
```

### 이메일 인증 안내
```
┌─────────────────────────────┐
│                             │
│     ✉️ 이메일을 확인하세요    │
│                             │
│  hong@email.com으로         │
│  인증 메일을 보냈습니다.     │
│                             │
│  메일함을 확인해주세요.      │
│                             │
│     [인증 메일 재발송]       │
└─────────────────────────────┘
```

---

## API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/auth/signup | 회원가입 |
| POST | /api/auth/verify-email | 이메일 인증 |
| POST | /api/auth/login | 로그인 |
| POST | /api/auth/logout | 로그아웃 |
| POST | /api/auth/refresh | 토큰 갱신 |
| POST | /api/auth/social/:provider | 소셜 로그인 |
| GET | /api/members/me | 내 정보 조회 |
| PUT | /api/members/me | 내 정보 수정 |
| PUT | /api/members/me/password | 비밀번호 변경 |
| DELETE | /api/members/me | 계정 탈퇴 |
| POST | /api/members/me/cancel-withdrawal | 탈퇴 취소 |
| GET | /api/members/check-username/:username | username 중복 체크 |
| GET | /api/members/check-email/:email | 이메일 중복 체크 |

---

## 개발 우선순위
1. Phase 1: 이메일 회원가입/로그인, 이메일 인증
2. Phase 2: 소셜 로그인, 계정 탈퇴/취소
